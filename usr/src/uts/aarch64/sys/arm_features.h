/*
 * This file and its contents are supplied under the terms of the
 * Common Development and Distribution License ("CDDL"), version 1.0.
 * You may only use this file in accordance with the terms of version
 * 1.0 of the CDDL.
 *
 * A full copy of the text of the CDDL should have accompanied this
 * source.  A copy of the CDDL is also available via the Internet at
 * http://www.illumos.org/license/CDDL.
 */

/* Copyright 2023 Richard Lowe */

#ifndef _SYS_ARM_FEATURES_H
#define	_SYS_ARM_FEATURES_H

/*
 * Optional ARM Processor features are enumerated here.  Ideally only those
 * described as FEAT_foo in the manuals.  Though if others prove necessary but
 * aren't formally a feature they will also be here (though not named
 * ARM_FEAT_...)
 *
 * These are taken from:
 *
 * Arm Architecture Reference Manual for A-profile architecture
 *    Chapter A2
 *    Armv8-A Architecture Extensions
 *    (ARM DDI 0487I.a) pp A2-71 et seq.
 */

#ifdef __cplusplus
extern "C" {
#endif

#include <sys/types.h>

typedef enum arm_feature {
	ARM_FEAT_AdvSIMD = 1,
	ARM_FEAT_AES,
	ARM_FEAT_PMULL,
	ARM_FEAT_CP15SDISABLE2,
	ARM_FEAT_CSV2,
	ARM_FEAT_CSV2_1p1,
	ARM_FEAT_CSV2_1p2,
	ARM_FEAT_CSV2_2,
	ARM_FEAT_CSV3,
	ARM_FEAT_DGH,
	ARM_FEAT_DoubleLock,
	ARM_FEAT_ETS,
	ARM_FEAT_FP,
	ARM_FEAT_IVIPT,
	ARM_FEAT_PCSRv8,
	ARM_FEAT_SPECRES,
	ARM_FEAT_RAS,
	ARM_FEAT_SB,
	ARM_FEAT_SHA1,
	ARM_FEAT_SHA256,
	ARM_FEAT_SSBS,
	ARM_FEAT_SSBS2,
	ARM_FEAT_CRC32,
	ARM_FEAT_nTLBPA,
	ARM_FEAT_Debugv8p1,
	ARM_FEAT_HPDS,
	ARM_FEAT_LOR,
	ARM_FEAT_LSE,
	ARM_FEAT_PAN,
	ARM_FEAT_PMUv3p1,
	ARM_FEAT_RDM,
	ARM_FEAT_HAFDBS,
	ARM_FEAT_VHE,
	ARM_FEAT_VMID16,
	ARM_FEAT_AA32BF16,
	ARM_FEAT_AA32HPD,
	ARM_FEAT_AA32I8MM,
	ARM_FEAT_PAN2,
	ARM_FEAT_BF16,
	ARM_FEAT_DPB2,
	ARM_FEAT_DPB,
	ARM_FEAT_Debugv8p2,
	ARM_FEAT_DotProd,
	ARM_FEAT_EVT,
	ARM_FEAT_F32MM,
	ARM_FEAT_F64MM,
	ARM_FEAT_FHM,
	ARM_FEAT_FP16,
	ARM_FEAT_I8MM,
	ARM_FEAT_IESB,
	ARM_FEAT_LPA,
	ARM_FEAT_LSMAOC,
	ARM_FEAT_LVA,
	ARM_FEAT_MPAM,
	ARM_FEAT_PCSRv8p2,
	ARM_FEAT_SHA3,
	ARM_FEAT_SHA512,
	ARM_FEAT_SM3,
	ARM_FEAT_SM4,
	ARM_FEAT_SPE,
	ARM_FEAT_SVE,
	ARM_FEAT_TTCNP,
	ARM_FEAT_HPDS2,
	ARM_FEAT_XNX,
	ARM_FEAT_UAO,
	ARM_FEAT_VPIPT,
	ARM_FEAT_CCIDX,
	ARM_FEAT_FCMA,
	ARM_FEAT_DoPD,
	ARM_FEAT_EPAC,
	ARM_FEAT_FPAC,
	ARM_FEAT_FPACCOMBINE,
	ARM_FEAT_JSCVT,
	ARM_FEAT_LRCPC,
	ARM_FEAT_NV,
	ARM_FEAT_PACQARMA5,
	ARM_FEAT_PACIMP,
	ARM_FEAT_PAuth,
	ARM_FEAT_PAuth2,
	ARM_FEAT_SPEv1p1,
	ARM_FEAT_AMUv1,
	ARM_FEAT_CNTSC,
	ARM_FEAT_Debugv8p4,
	ARM_FEAT_DoubleFault,
	ARM_FEAT_DIT,
	ARM_FEAT_FlagM,
	ARM_FEAT_IDST,
	ARM_FEAT_LRCPC2,
	ARM_FEAT_LSE2,
	ARM_FEAT_NV2,
	ARM_FEAT_PMUv3p4,
	ARM_FEAT_RASv1p1,
	ARM_FEAT_S2FWB,
	ARM_FEAT_SEL2,
	ARM_FEAT_TLBIOS,
	ARM_FEAT_TLBIRANGE,
	ARM_FEAT_TRF,
	ARM_FEAT_TTL,
	ARM_FEAT_BBM,
	ARM_FEAT_TTST,
	ARM_FEAT_BTI,
	ARM_FEAT_FlagM2,
	ARM_FEAT_ExS,
	ARM_FEAT_E0PD,
	ARM_FEAT_FRINTTS,
	ARM_FEAT_GTG,
	ARM_FEAT_MTE,
	ARM_FEAT_MTE2,
	ARM_FEAT_PMUv3p5,
	ARM_FEAT_RNG,
	ARM_FEAT_AMUv1p1,
	ARM_FEAT_ECV,
	ARM_FEAT_FGT,
	ARM_FEAT_MPAMv0p1,
	ARM_FEAT_MPAMv1p1,
	ARM_FEAT_MTPMU,
	ARM_FEAT_TWED,
	ARM_FEAT_ETMv4,
	ARM_FEAT_ETMv4p1,
	ARM_FEAT_ETMv4p2,
	ARM_FEAT_ETMv4p3,
	ARM_FEAT_ETMv4p4,
	ARM_FEAT_ETMv4p5,
	ARM_FEAT_ETMv4p6,
	ARM_FEAT_GICv3,
	ARM_FEAT_GICv3p1,
	ARM_FEAT_GICv3_TDIR,
	ARM_FEAT_GICv4,
	ARM_FEAT_GICv4p1,
	ARM_FEAT_PMUv3,
	ARM_FEAT_ETE,
	ARM_FEAT_ETEv1p1,
	ARM_FEAT_SVE2,
	ARM_FEAT_SVE_AES,
	ARM_FEAT_SVE_PMULL128,
	ARM_FEAT_SVE_BitPerm,
	ARM_FEAT_SVE_SHA3,
	ARM_FEAT_SVE_SM4,
	ARM_FEAT_TME,
	ARM_FEAT_TRBE,
	ARM_FEAT_SME,

	ARM_FEAT_AFP,
	ARM_FEAT_HCX,
	ARM_FEAT_LPA2,
	ARM_FEAT_LS64,
	ARM_FEAT_LS64_V,
	ARM_FEAT_LS64_ACCDATA,
	ARM_FEAT_MTE3,
	ARM_FEAT_PAN3,
	ARM_FEAT_PMUv3p7,
	ARM_FEAT_RPRES,
	ARM_FEAT_RME,
	ARM_FEAT_SME_FA64,
	ARM_FEAT_SME_F64F64,
	ARM_FEAT_SME_I16I64,
	ARM_FEAT_EBF16,
	ARM_FEAT_SPEv1p2,
	ARM_FEAT_WFxT,
	ARM_FEAT_XS,
	ARM_FEAT_BRBE,

	ARM_FEAT_CMOW,
	ARM_FEAT_CONSTPACFIELD,
	ARM_FEAT_Debugv8p8,
	ARM_FEAT_HBC,
	ARM_FEAT_HPMN0,
	ARM_FEAT_NMI,
	ARM_FEAT_GICv3_NMI,
	ARM_FEAT_MOPS,
	ARM_FEAT_PACQARMA3,
	ARM_FEAT_PMUv3_TH,
	ARM_FEAT_PMUv3p8,
	ARM_FEAT_PMUv3_EXT64,
	ARM_FEAT_PMUv3_EXT32,
	ARM_FEAT_RNG_TRAP,
	ARM_FEAT_SPEv1p3,
	ARM_FEAT_TIDCP1,
	ARM_FEAT_BRBEv1p1,

	ARM_FEAT_ABLE,
	ARM_FEAT_ADERR,
	ARM_FEAT_ANERR,
	ARM_FEAT_AIE,
	ARM_FEAT_B16B16,
	ARM_FEAT_CLRBHB,
	ARM_FEAT_CHK,
	ARM_FEAT_CSSC,
	ARM_FEAT_CSV2_3,
	ARM_FEAT_D128,
	ARM_FEAT_Debugv8p9,
	ARM_FEAT_DoubleFault2,
	ARM_FEAT_EBEP,
	ARM_FEAT_ECBHB,
	ARM_FEAT_ETEv1p3,
	ARM_FEAT_FGT2,
	ARM_FEAT_GCS,
	ARM_FEAT_HAFT,
	ARM_FEAT_ITE,
	ARM_FEAT_LRCPC3,
	ARM_FEAT_LSE128,
	ARM_FEAT_LVA3,
	ARM_FEAT_MEC,
	ARM_FEAT_MTE4,
	ARM_FEAT_MTE_CANONICAL_TAGS,
	ARM_FEAT_MTE_TAGGED_FAR,
	ARM_FEAT_MTE_STORE_ONLY,
	ARM_FEAT_MTE_NO_ADDRESS_TAGS,
	ARM_FEAT_MTE_ASYM_FAULT,
	ARM_FEAT_MTE_ASYNC,
	ARM_FEAT_MTE_PERM,
	ARM_FEAT_PCSRv8p9,
	ARM_FEAT_PIE,
	ARM_FEAT_POE,
	ARM_FEAT_S1PIE,
	ARM_FEAT_S2PIE,
	ARM_FEAT_S1POE,
	ARM_FEAT_S2POE,
	ARM_FEAT_PMUv3p9,
	ARM_FEAT_PMUv3_EDGE,
	ARM_FEAT_PMUv3_ICNTR,
	ARM_FEAT_PMUv3_SS,
	ARM_FEAT_PRFMSLC,
	ARM_FEAT_RASv2,
	ARM_FEAT_RPRFM,
	ARM_FEAT_SCTLR2,
	ARM_FEAT_SEBEP,
	ARM_FEAT_SME_F16F16,
	ARM_FEAT_SME2,
	ARM_FEAT_SME2p1,
	ARM_FEAT_SPECRES2,
	ARM_FEAT_SPMU,
	ARM_FEAT_SPEv1p4,
	ARM_FEAT_SPE_FDS,
	ARM_FEAT_SVE2p1,
	ARM_FEAT_SYSINSTR128,
	ARM_FEAT_SYSREG128,
	ARM_FEAT_TCR2,
	ARM_FEAT_THE,
	ARM_FEAT_TRBE_EXT,
	ARM_FEAT_TRBE_MPAM,

	ARM_FEAT_PFAR,
} arm_feature_t;

#define	NUM_ARM_FEATURES	(ARM_FEAT_PFAR + 1)

extern uchar_t arm_features[];

void print_arm_features(void *);
boolean_t compare_arm_features(void *, void*);
boolean_t has_arm_feature(void *, arm_feature_t);
void add_arm_feature(void *, arm_feature_t);
void remove_arm_feature(void *, arm_feature_t);

#ifdef __cplusplus
}
#endif

#endif /* _SYS_ARM_FEATURES_H */
